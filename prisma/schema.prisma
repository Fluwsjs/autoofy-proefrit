// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Tenant {
  id              String    @id @default(cuid())
  name            String
  email           String    @unique
  // Bedrijfsgegevens
  companyName     String?   // OfficiÃ«le bedrijfsnaam
  companyAddress  String?   // Bedrijfsadres
  companyZipCode  String?   // Postcode
  companyCity     String?   // Plaats
  companyPhone    String?   // Telefoonnummer
  companyKvK      String?   // KvK nummer
  companyVAT      String?   // BTW nummer
  companyLogo     String?   // Bedrijfslogo (base64 of URL)
  createdAt       DateTime  @default(now())
  users           User[]
  testrides       Testride[]
  sellers         Seller[]
}

model DealerPlate {
  id        String   @id @default(cuid())
  plate     String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId    String
  createdAt DateTime @default(now())
  testrides Testride[]
}

model Seller {
  id        String   @id @default(cuid())
  name      String
  email     String?
  phone     String?
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId  String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  testrides Testride[]
}

model User {
  id                String   @id @default(cuid())
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId          String
  name              String
  email             String   @unique
  password          String
  role              Role     @default(STAFF)
  emailVerified     Boolean  @default(false)
  emailVerifiedAt   DateTime?
  isActive          Boolean  @default(true) // Account actief/gedeactiveerd
  sellerSignatureUrl String? // Eenmalige verkoper handtekening/stempel (herbruikbaar)
  twoFactorEnabled  Boolean  @default(false)
  twoFactorSecret   String?
  createdAt         DateTime @default(now())
  dealerPlates      DealerPlate[]
  emailVerificationToken VerificationToken?
  passwordResetToken PasswordResetToken?
}

model Testride {
  id                  String    @id @default(cuid())
  tenant              Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  tenantId            String
  customerName        String
  customerEmail       String
  customerPhone       String?
  address             String
  startTime           DateTime
  endTime             DateTime
  date                DateTime
  carType             String
  licensePlate        String?
  driverLicenseNumber String?
  idCountryOfOrigin   String?  // Land van herkomst ID kaart of rijbewijs
  dealerPlateId       String?
  dealerPlate         DealerPlate? @relation(fields: [dealerPlateId], references: [id], onDelete: SetNull)
  sellerId            String?  // Verkoper die deze proefrit begeleidt
  seller              Seller?  @relation(fields: [sellerId], references: [id], onDelete: SetNull)
  idPhotoFrontUrl     String?   // ID foto voorkant
  idPhotoBackUrl      String?  // ID foto achterkant
  damagePhotos        Json?    // Array van schade foto URLs
  customerSignatureUrl String? // Klant handtekening (per proefrit)
  sellerSignatureUrl   String?  // Verkoper handtekening/stempel (optioneel, kan van User komen)
  completionSignatureUrl String? // Verkoper handtekening bij afronding
  customerCompletionSignatureUrl String? // Klant handtekening bij afronding
  dealerPlateCardGiven Boolean  @default(false) // Kentekenpas handelaarskenteken meegegeven
  eigenRisico         Int      @default(0) // Eigen risico bedrag (0-1000)
  aantalSleutels      Int      @default(1) // Aantal sleutels meegegeven (1-4)
  status              TestrideStatus @default(PENDING) // Status van de proefrit
  completedAt         DateTime? // Datum/tijd van afronding
  vehicleSold         Boolean  @default(false) // Voertuig verkocht aan deze klant
  feedbackEmailSent   Boolean  @default(false) // Feedback verzoek email verstuurd
  startKm             Int
  endKm               Int?
  notes               String?
  createdAt           DateTime  @default(now())
  feedback            Feedback?
}

enum Role {
  ADMIN
  STAFF
}

enum TestrideStatus {
  PENDING
  COMPLETED
}

model SuperAdmin {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
}

model VerificationToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  createdAt DateTime @default(now())
}

model Feedback {
  id                  String   @id @default(cuid())
  testrideId          String   @unique
  testride            Testride @relation(fields: [testrideId], references: [id], onDelete: Cascade)
  
  // Ratings (1-5 sterren)
  overallRating       Int      // Algehele ervaring
  serviceRating       Int      // Service van verkoper
  vehicleRating       Int      // Staat van het voertuig
  infoRating          Int      // Informatie voorziening
  
  // Open vragen
  bestPart            String?  // Wat vond u het beste?
  improvements        String?  // Wat kunnen we verbeteren?
  wouldRecommend      Boolean  // Zou u ons aanbevelen?
  additionalComments  String?  // Overige opmerkingen
  
  createdAt           DateTime @default(now())
}

model FeedbackToken {
  id          String   @id @default(cuid())
  token       String   @unique
  testrideId  String   @unique
  expiresAt   DateTime
  usedAt      DateTime? // Null als nog niet gebruikt
  createdAt   DateTime @default(now())
}

